<apex:page controller="GetAccountTransactionPDFController" renderAs="pdf" 
           applyBodyTag="false" showHeader="false" sidebar="false" standardStylesheets="false">
    <head>
        <style>
            @page {
                size: A4;
                margin-left: 1cm;
                margin-right: 1cm;
                margin-top: 4cm;
                margin-bottom: 2cm;
                
                @top-center { content: element(header); }
                @bottom-center { content: element(footer); }
            }
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            .header-title {
                font-size: 20px;
                font-weight: bold;
                margin-bottom: 20px;
                color: #333;
            	padding: 10px;
            }
            
            .header-logo {
                position: absolute;
                top: 0;
                right: 0;
                font-size: 18px;
            }
            
            .logo-aedon {
                color: #4ECDC4;
            }
            
            .logo-accounting {
                color: #FF6B6B;
            }
            
            .header-content {
                display: table;
                width: 100%;
                margin-top: 10px;
            }
            
            .header-column {
                display: table-cell;
                vertical-align: top;
                padding-right: 20px;
                width: 33.33%;
            }
            
            .header-label {
                font-size: 9px;
                font-weight: bold;
                margin-bottom: 5px;
                color: #333;
            }
            
            .header-value {
                font-size: 9px;
                margin-bottom: 3px;
                color: #666;
            }
            
            .footer {
                position: running(footer);
                display: block;
                text-align: center;
                padding-top: 10px;
                border-top: 1px solid #ddd;
                font-size: 8px;
                color: #666;
            }
            
            .page-number:before {
                content: "Page " counter(page) " of " counter(pages);
            }
            
            .content {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .template-section {
                margin-top: 20px;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #ddd;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
                font-size: 8px;
            }
            
            th {
                background-color: #0070d2;
                color: white;
                font-weight: bold;
                text-align: left;
                padding: 6px 4px;
                border: 1px solid #0070d2;
                font-size: 8px;
            }
            
            td {
                padding: 5px 4px;
                border: 1px solid #ddd;
                word-wrap: break-word;
            }
            
            tr:nth-child(even) {
                background-color: #f9f9f9;
            }
            
            .no-data {
                font-style: italic;
                color: #666;
                padding: 15px;
                text-align: center;
                background-color: #f9f9f9;
                border: 1px dashed #ccc;
                margin-bottom: 20px;
            }
            
            .page-break { 
                page-break-after: always; 
            }
            
            .text-right {
                text-align: right;
            }
            
            .total-row {
                font-weight: bold;
                background-color: #f0f0f0 !important;
            }
            
            .total-label {
                text-align: right;
                padding-right: 10px;
            }
        </style>
    </head>
    
    <body style="font-family:Arial,snas-serif; font-size: 9px;line-height: 1.4; color: #333;">
        <!-- Header -->
        <div style="display: block; padding: 15px; border-bottom: 2px solid #ddd;">
            <div style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #333; padding: 10px;">
                Account Activity Statement
                <div class="header-logo">
                    <span class="logo-aedon">Aedon</span><span class="logo-accounting">.Accounting</span>
                </div>
            </div>
            
            <div class="header-content">
                <!-- Left Column - Customer Details -->
                <div class="header-column">
                    <div class="header-label">{!accountDetails.Name}</div>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingStreet))}">
                        <div class="header-value">{!accountDetails.BillingStreet}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingCity))}">
                        <div class="header-value">{!accountDetails.BillingCity}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingState))}">
                        <div class="header-value">{!accountDetails.BillingState}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingPostalCode))}">
                        <div class="header-value">{!accountDetails.BillingPostalCode}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingCountry))}">
                        <div class="header-value">{!accountDetails.BillingCountry}</div>
                    </apex:outputPanel>
                </div>
                
                <!-- Middle Column - Statement Details -->
                <div class="header-column">
                    <div class="header-label">Statement Date</div>
                    <div class="header-value">
                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                            <apex:param value="{!NOW()}"/>
                        </apex:outputText>
                    </div>
                    <br/>
                    <div class="header-label">Sent Date</div>
                    <div class="header-value">
                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                            <apex:param value="{!NOW()}"/>
                        </apex:outputText>
                    </div>
                    <br/>
                    <div class="header-label">Currency</div>
                    <div class="header-value">{!accountDetails.Currency__r.Name}</div>
                </div>
                
                <!-- Right Column - Company Address -->
                <div class="header-column">
                    <div class="header-label">British Horizon</div>
                    <div class="header-value">Suite 48</div>
                    <div class="header-value">792 Wilmslow Road</div>
                    <div class="header-value">Manchester</div>
                    <div class="header-value">Greater Manchester</div>
                    <div class="header-value">M20 6UG</div>
                    <div class="header-value">UK</div>
                </div>
            </div>
            
            <div class="header-content" style="margin-top: 10px;">
                <!-- Account Number and VAT Number -->
                <div class="header-column">
                    <div class="header-label">Account Number</div>
                    <div class="header-value">{!accountDetails.AccountNumber}</div>
                </div>
                <div class="header-column">
                    <!-- Empty for spacing -->
                </div>
                <div class="header-column">
                    <div class="header-label">VAT Number</div>
                    <div class="header-value">{!accountDetails.Company__r.Company_Registration_Number__c}</div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="page-number"></div>
            <div>Generated on <apex:outputText value="{0,date,dd/MM/yyyy HH:mm}"><apex:param value="{!NOW()}"/></apex:outputText></div>
        </div>
        
        <!-- Email Template Content (if any) -->
        <apex:outputPanel rendered="{!NOT(ISBLANK(templateHtml))}">
            <div class="content template-section">
                <apex:outputText value="{!templateHtml}" escape="false"/>
            </div>
        </apex:outputPanel>
        
        <!-- Unified Transaction Table -->
        <div class="content">
            <table>
                <thead>
                    <tr>
                        <th>Invoice Date</th>
                        <th>Number</th>
                        <th>Type</th>
                        <th>Reference</th>
                        <th>Currency</th>
                        <th>Status</th>
                        <th class="text-right">Outstanding</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Invoice Records -->
                    <apex:variable var="totalOutstanding" value="{!0}" />
                    <apex:repeat value="{!queryResults}" var="result">
                        <apex:outputPanel rendered="{!result.objectName == 'Invoice__c'}">
                            <apex:repeat value="{!result.records}" var="record">
                                <tr>
                                    <td>
                                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                                            <apex:param value="{!record['Invoice_Date__c']}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>{!record['Transaction_Number__c']}</td>
                                    <td>SP</td>
                                    <td>{!record['Customer_reference__c']}</td>
                                    <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                    <td>{!record['Posting_Status__c']}</td>
                                    <td class="text-right">
                                        <apex:outputText value="{0, number, ###,###,##0.00}">
                                            <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                        </apex:outputText>
                                    </td>
                                </tr>
                                <apex:variable var="totalOutstanding" value="{!totalOutstanding + record['Outstanding_Amount__c']}" />
                            </apex:repeat>
                        </apex:outputPanel>
                        
                        <!-- Payment Records -->
                        <apex:outputPanel rendered="{!result.objectName == 'Payment__c'}">
                            <apex:repeat value="{!result.records}" var="record">
                                <tr>
                                    <td>
                                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                                            <apex:param value="{!record['Pay_Date__c']}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>{!record['Transaction_Number__c']}</td>
                                    <td>Payment</td>
                                    <td>{!record['Payment_Reference__c']}</td>
                                    <td>{!record['Currency__r']['ISO_Code__c']}</td>
                                    <td>{!record['Posting_Status__c']}</td>
                                    <td class="text-right">
                                        <apex:outputText value="{0, number, ###,###,##0.00}">
                                            <apex:param value="{!record['Amount__c']}"/>
                                        </apex:outputText>
                                    </td>
                                </tr>
                                <apex:variable var="totalOutstanding" value="{!totalOutstanding + record['Amount__c']}" />
                            </apex:repeat>
                        </apex:outputPanel>
                        
                        <!-- Credit Note Records -->
                        <apex:outputPanel rendered="{!result.objectName == 'Credit_Note__c'}">
                            <apex:repeat value="{!result.records}" var="record">
                                <tr>
                                    <td>
                                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                                            <apex:param value="{!record['Invoice_Date__c']}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>{!record['Transaction_Number__c']}</td>
                                    <td>Credit Note</td>
                                    <td>{!record['Customer_reference__c']}</td>
                                    <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                    <td>{!record['Posting_Status__c']}</td>
                                    <td class="text-right">
                                        <apex:outputText value="{0, number, ###,###,##0.00}">
                                            <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                        </apex:outputText>
                                    </td>
                                </tr>
                                <apex:variable var="totalOutstanding" value="{!totalOutstanding + record['Outstanding_Amount__c']}" />
                            </apex:repeat>
                        </apex:outputPanel>
                        
                        <!-- Debit Note Records -->
                        <apex:outputPanel rendered="{!result.objectName == 'Debit_Note__c'}">
                            <apex:repeat value="{!result.records}" var="record">
                                <tr>
                                    <td>
                                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                                            <apex:param value="{!record['Invoice_Date__c']}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>{!record['Transaction_Number__c']}</td>
                                    <td>Debit Note</td>
                                    <td>{!record['Customer_reference__c']}</td>
                                    <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                    <td>{!record['Posting_Status__c']}</td>
                                    <td class="text-right">
                                        <apex:outputText value="{0, number, ###,###,##0.00}">
                                            <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                        </apex:outputText>
                                    </td>
                                </tr>
                                <apex:variable var="totalOutstanding" value="{!totalOutstanding + record['Outstanding_Amount__c']}" />
                            </apex:repeat>
                        </apex:outputPanel>
                        
                        <!-- Receipts Note Records -->
                        <apex:outputPanel rendered="{!result.objectName == 'Receipts_Note__c'}">
                            <apex:repeat value="{!result.records}" var="record">
                                <tr>
                                    <td>
                                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                                            <apex:param value="{!record['Invoice_Date__c']}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>{!record['Transaction_Number__c']}</td>
                                    <td>Receipt Note</td>
                                    <td></td>
                                    <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                    <td>{!record['Posting_Status__c']}</td>
                                    <td class="text-right">
                                        <apex:outputText value="{0, number, ###,###,##0.00}">
                                            <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                        </apex:outputText>
                                    </td>
                                </tr>
                                <apex:variable var="totalOutstanding" value="{!totalOutstanding + record['Outstanding_Amount__c']}" />
                            </apex:repeat>
                        </apex:outputPanel>
                        
                        <!-- Journal Records -->
                        <apex:outputPanel rendered="{!result.objectName == 'Journal__c'}">
                            <apex:repeat value="{!result.records}" var="record">
                                <tr>
                                    <td>
                                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                                            <apex:param value="{!record['Journal__r']['Invoice_Date__c']}"/>
                                        </apex:outputText>
                                    </td>
                                    <td>{!record['Journal__r']['Transaction_Number__c']}</td>
                                    <td>Journal</td>
                                    <td>{!record['Name']}</td>
                                    <td>{!record['Journal__r']['Transaction_Currency__r']['ISO_Code__c']}</td>
                                    <!-- <td>{!record['Journal__r']['Posting_Status__c']}</td> -->
                                    <td class="text-right">0.00</td>
                                </tr>
                            </apex:repeat>
                        </apex:outputPanel>
                    </apex:repeat>
                    
                    <!-- Total Row -->
                    <tr class="total-row">
                        <td colspan="6" class="total-label">Total Outstanding:</td>
                        <td class="text-right">
                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                <apex:param value="{!totalOutstanding}"/>
                            </apex:outputText>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
    </body>
</apex:page>