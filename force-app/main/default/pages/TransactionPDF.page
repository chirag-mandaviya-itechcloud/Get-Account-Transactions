<apex:page controller="GetAccountTransactionPDFController" renderAs="pdf" 
           applyBodyTag="false" showHeader="false" sidebar="false" standardStylesheets="false">
    <head>
        <style>
            @page {
                size: A4;
                margin-left: 1cm;
                margin-right: 1cm;
                margin-top: 4cm;
                margin-bottom: 2cm;
                
                @top-center { content: element(header); }
                @bottom-center { content: element(footer); }
            }
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body { 
                font-family: Arial, sans-serif;
                font-size: 9px;
                line-height: 1.4;
                color: #333;
            }
            
            .header {
                position: running(header);
                display: block;
                padding-bottom: 15px;
                border-bottom: 2px solid #ddd;
            }
            
            .header-title {
                font-size: 20px;
                font-weight: bold;
                margin-bottom: 20px;
                color: #333;
                position: relative;
            }
            
            .header-logo {
                position: absolute;
                top: 0;
                right: 0;
                font-size: 18px;
            }
            
            .logo-aedon {
                color: #4ECDC4;
            }
            
            .logo-accounting {
                color: #FF6B6B;
            }
            
            .header-content {
                display: table;
                width: 100%;
                margin-top: 10px;
            }
            
            .header-column {
                display: table-cell;
                vertical-align: top;
                padding-right: 20px;
                width: 33.33%;
            }
            
            .header-label {
                font-size: 9px;
                font-weight: bold;
                margin-bottom: 5px;
                color: #333;
            }
            
            .header-value {
                font-size: 9px;
                margin-bottom: 3px;
                color: #666;
            }
            
            .footer {
                position: running(footer);
                display: block;
                text-align: center;
                padding-top: 10px;
                border-top: 1px solid #ddd;
                font-size: 8px;
                color: #666;
            }
            
            .page-number:before {
                content: "Page " counter(page) " of " counter(pages);
            }
            
            .content {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .template-section {
                margin-top: 20px;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #ddd;
            }
            
            .section-title {
                font-size: 12px;
                font-weight: bold;
                margin: 20px 0 10px 0;
                padding: 8px 10px;
                background-color: #f0f0f0;
                border-left: 4px solid #0070d2;
                color: #0070d2;
            }
            
            .record-count {
                font-size: 10px;
                color: #666;
                margin-left: 10px;
                font-weight: normal;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
                font-size: 8px;
            }
            
            th {
                background-color: #0070d2;
                color: white;
                font-weight: bold;
                text-align: left;
                padding: 6px 4px;
                border: 1px solid #0070d2;
                font-size: 8px;
            }
            
            td {
                padding: 5px 4px;
                border: 1px solid #ddd;
                word-wrap: break-word;
            }
            
            tr:nth-child(even) {
                background-color: #f9f9f9;
            }
            
            .no-data {
                font-style: italic;
                color: #666;
                padding: 15px;
                text-align: center;
                background-color: #f9f9f9;
                border: 1px dashed #ccc;
                margin-bottom: 20px;
            }
            
            .page-break { 
                page-break-after: always; 
            }
            
            .text-right {
                text-align: right;
            }
        </style>
    </head>
    
    <body>
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                Account Activity Statement
                <div class="header-logo">
                    <span class="logo-aedon">Aedon</span><span class="logo-accounting">.Accounting</span>
                </div>
            </div>
            
            <div class="header-content">
                <!-- Left Column - Customer Details -->
                <div class="header-column">
                    <div class="header-label">{!accountDetails.Name}</div>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingStreet))}">
                        <div class="header-value">{!accountDetails.BillingStreet}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingCity))}">
                        <div class="header-value">{!accountDetails.BillingCity}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingState))}">
                        <div class="header-value">{!accountDetails.BillingState}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingPostalCode))}">
                        <div class="header-value">{!accountDetails.BillingPostalCode}</div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!NOT(ISBLANK(accountDetails.BillingCountry))}">
                        <div class="header-value">{!accountDetails.BillingCountry}</div>
                    </apex:outputPanel>
                </div>
                
                <!-- Middle Column - Statement Details -->
                <div class="header-column">
                    <div class="header-label">Statement Date</div>
                    <div class="header-value">
                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                            <apex:param value="{!NOW()}"/>
                        </apex:outputText>
                    </div>
                    <br/>
                    <div class="header-label">Sent Date</div>
                    <div class="header-value">
                        <apex:outputText value="{0,date,dd/MM/yyyy}">
                            <apex:param value="{!NOW()}"/>
                        </apex:outputText>
                    </div>
                    <br/>
                    <div class="header-label">Currency</div>
                    <div class="header-value">{!accountDetails.Currency__r.Name}</div>
                </div>
                
                <!-- Right Column - Company Address -->
                <div class="header-column">
                    <div class="header-label">British Horizon</div>
                    <div class="header-value">Suite 48</div>
                    <div class="header-value">792 Wilmslow Road</div>
                    <div class="header-value">Manchester</div>
                    <div class="header-value">Greater Manchester</div>
                    <div class="header-value">M20 6UG</div>
                    <div class="header-value">UK</div>
                </div>
            </div>
            
            <div class="header-content" style="margin-top: 10px;">
                <!-- Account Number and VAT Number -->
                <div class="header-column">
                    <div class="header-label">Account Number</div>
                    <div class="header-value">{!accountDetails.AccountNumber}</div>
                </div>
                <div class="header-column">
                    <!-- Empty for spacing -->
                </div>
                <div class="header-column">
                    <!-- <div class="header-label">VAT Number</div>
                    <div class="header-value">{!accountDetails.VAT_Number__c}</div> -->
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="page-number"></div>
            <div>Generated on <apex:outputText value="{0,date,dd/MM/yyyy HH:mm}"><apex:param value="{!NOW()}"/></apex:outputText></div>
        </div>
        
        <!-- Email Template Content (if any) -->
        <apex:outputPanel rendered="{!NOT(ISBLANK(templateHtml))}">
            <div class="content template-section">
                <apex:outputText value="{!templateHtml}" escape="false"/>
            </div>
        </apex:outputPanel>
        
        <!-- Query Results Tables -->
        <apex:repeat value="{!queryResults}" var="result">
            <div class="content">
                <div class="section-title">
                    {!result.objectName}
                    <span class="record-count">
                        ({!result.records.size} record<apex:outputText value="{!IF(result.records.size != 1, 's', '')}" />)
                    </span>
                </div>
                
                <!-- Display table if records exist -->
                <apex:outputPanel rendered="{!result.records.size > 0}">
                    
                    <!-- For Invoice__c Object -->
                    <apex:outputPanel rendered="{!result.objectName == 'Invoice__c'}">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction Number</th>
                                    <th>Account</th>
                                    <th>Invoice Date</th>
                                    <th>Due Date</th>
                                    <th>Currency</th>
                                    <th>Gross Amount</th>
                                    <th>Outstanding Amount</th>
                                    <th>Customer Reference</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!result.records}" var="record">
                                    <tr>
                                        <td>{!record['Transaction_Number__c']}</td>
                                        <td>{!record['Account__r']['Name']}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Invoice_Date__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Due_On__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Gross_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Customer_reference__c']}</td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    
                    <!-- For Payment__c Object -->
                    <apex:outputPanel rendered="{!result.objectName == 'Payment__c'}">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction Number</th>
                                    <th>Account</th>
                                    <th>Pay Date</th>
                                    <th>Currency</th>
                                    <th>Amount</th>
                                    <th>Payment Reference</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!result.records}" var="record">
                                    <tr>
                                        <td>{!record['Transaction_Number__c']}</td>
                                        <td>{!record['Account__r']['Name']}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Pay_Date__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Currency__r']['ISO_Code__c']}</td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Payment_Reference__c']}</td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    
                    <!-- For Credit_Note__c Object -->
                    <apex:outputPanel rendered="{!result.objectName == 'Credit_Note__c'}">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction Number</th>
                                    <th>Account</th>
                                    <th>Invoice Date</th>
                                    <th>Currency</th>
                                    <th>Gross Amount</th>
                                    <th>Outstanding Amount</th>
                                    <th>Customer Reference</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!result.records}" var="record">
                                    <tr>
                                        <td>{!record['Transaction_Number__c']}</td>
                                        <td>{!record['Account__r']['Name']}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Invoice_Date__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Gross_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Customer_reference__c']}</td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    
                    <!-- For Journal__c Object (Journal Lines) -->
                    <apex:outputPanel rendered="{!result.objectName == 'Journal__c'}">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Account</th>
                                    <th>Invoice Date</th>
                                    <th>Transaction Number</th>
                                    <th>Currency</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!result.records}" var="record">
                                    <tr>
                                        <td>{!record['Name']}</td>
                                        <td>{!record['Account__r']['Name']}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Journal__r']['Invoice_Date__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Journal__r']['Transaction_Number__c']}</td>
                                        <td>{!record['Journal__r']['Transaction_Currency__r']['ISO_Code__c']}</td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    
                    <!-- For Receipts_Note__c Object -->
                    <apex:outputPanel rendered="{!result.objectName == 'Receipts_Note__c'}">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction Number</th>
                                    <th>To Account</th>
                                    <th>Invoice Date</th>
                                    <th>Currency</th>
                                    <th>Gross Amount</th>
                                    <th>Outstanding Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!result.records}" var="record">
                                    <tr>
                                        <td>{!record['Transaction_Number__c']}</td>
                                        <td>{!record['To_Account__r']['Name']}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Invoice_Date__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Gross_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    
                    <!-- For Debit_Note__c Object -->
                    <apex:outputPanel rendered="{!result.objectName == 'Debit_Note__c'}">
                        <table>
                            <thead>
                                <tr>
                                    <th>Transaction Number</th>
                                    <th>Account</th>
                                    <th>Invoice Date</th>
                                    <th>Currency</th>
                                    <th>Gross Amount</th>
                                    <th>Outstanding Amount</th>
                                    <th>Customer Reference</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!result.records}" var="record">
                                    <tr>
                                        <td>{!record['Transaction_Number__c']}</td>
                                        <td>{!record['Account__r']['Name']}</td>
                                        <td>
                                            <apex:outputText value="{0,date,dd/MM/yyyy}">
                                                <apex:param value="{!record['Invoice_Date__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Transaction_Currency__r']['ISO_Code__c']}</td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Gross_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td class="text-right">
                                            <apex:outputText value="{0, number, ###,###,##0.00}">
                                                <apex:param value="{!record['Outstanding_Amount__c']}"/>
                                            </apex:outputText>
                                        </td>
                                        <td>{!record['Customer_reference__c']}</td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                    </apex:outputPanel>
                    
                </apex:outputPanel>
                
                <!-- Show message if no records -->
                <apex:outputPanel rendered="{!result.records.size == 0}">
                    <div class="no-data">
                        No {!result.objectName} records found
                    </div>
                </apex:outputPanel>
            </div>
        </apex:repeat>
        
    </body>
</apex:page>